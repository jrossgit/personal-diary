{% extends "base.html" %}

{% block content %}

<h1>To Do
    {% include "components/todos/completed_today_counter.html" with number=number_todos_today %}
</h1>

<b></b>

<a class="btn btn-primary mb-3 rounded-0" href="{% url 'todo-category-create' %}" role="button">New Category</a>

<div class="card mb-3 border-primary rounded-0 border-3" id="category-unsorted">
    <div class="card-body bg-primary text-white">
        <h4 class="card-title">Miscellaneous Tasks</h4>
    </div>
        <ul class="list-group list-group-flush">
        {% for todo in unsorted_todos %}
            {% include "components/todos/card_todo.html" with todo=todo %}
        {% endfor %}

            <li class="list-group-item">
                <button
                hx-get="{% url 'htmx-todo-card-form' %}"
                hx-trigger="click"
                hx-target="closest li"
                hx-swap="beforebegin"
                type="button" class="btn btn-dark">+</button>
            </li>
        </ul>
</div>


{% for category in new_categories %}
<div class="card mb-3 border-primary rounded-0 border-3" id="category-{{category.name|slugify}}">
    <div class="card-body bg-primary text-white"
        hx-get="{% url 'htmx-todo-category-form' todo_category_id=category.id %}"
        hx-trigger="dblclick"
        hx-target="this"
        hx-swap="outerHTML">
        <h4 class="card-title">{{ category.name }}</h4>
    </div>
    <ul class="list-group list-group-flush">
        {% for todo in category.todos.all %}
            {% include "components/todos/card_todo.html" with todo=todo %}
        {% endfor %}

        <li class="list-group-item">
            <button
                hx-get="{% url 'htmx-todo-card-form' category_pk=category.id %}"
                hx-trigger="click"
                hx-target="closest li"
                hx-swap="beforebegin"
            type="button" class="btn btn-dark">New Task</button>
            <button
            class="btn btn-warning"
            hx-delete="{% url 'htmx-todo-category-delete' pk=category.id %}"
            hx-trigger="click"
            hx-swap="delete"
            hx-target="#category-{{category.name|slugify}}"
            hx-confirm="Delete this category?">Close</button>
        </li>
    </ul>
</div>
{% endfor %}

{% endblock %}
